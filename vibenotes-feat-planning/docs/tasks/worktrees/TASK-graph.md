# üéØ Task: Knowledge Graph View

**Objective**: Implement an interactive 2D force-directed graph visualization to explore connections between notes.
**Type**: Feature
**Priority**: Medium
**Estimated Complexity**: Medium

---

## üìã Requirements

### Functional Requirements
- **[REQ-001]**: Render nodes for each Note in the database.
  - Acceptance: Nodes appear on canvas with labels.
- **[REQ-002]**: Render links (edges) for internal references between notes.
  - Acceptance: Lines connect related notes.
- **[REQ-003]**: Interactive zoom and pan controls.
  - Acceptance: User can zoom in/out and drag the canvas.
- **[REQ-004]**: Click node to navigate to the note.
  - Acceptance: Clicking a node redirects to `/notes/[id]`.
- **[REQ-005]**: Hover effects for nodes and links.
  - Acceptance: Highlight connected nodes/links on hover.

### Technical Requirements
- **[TECH-001]**: Use `react-force-graph-2d` for rendering.
- **[TECH-002]**: Implement as a Client Component (`'use client'`) wrapped in a Feature container.
- **[TECH-003]**: Optimize for performance with > 1000 nodes.
- **[TECH-004]**: Use `useResizeObserver` for responsive canvas sizing.

### Out of Scope
- 3D Graph view (v2).
- Editing graph structure (adding links via graph).
- Complex physics customization (gravity/repulsion settings UI).

---

## üèóÔ∏è Implementation Plan

### Phase 1: Setup
- [ ] Install dependencies: `npm install react-force-graph-2d`
- [ ] Create feature directory: `src/features/graph`
- [ ] Define types in `src/features/graph/types.ts` (GraphNode, GraphLink)

### Phase 2: Core Component
- [ ] Create `GraphCanvas.tsx` (The wrapper for `ForceGraph2D`).
- [ ] Implement `useGraphData` hook to transform Note data into Graph format.
- [ ] Configure node styling (colors based on tags/folders).
- [ ] Implement interaction handlers (onNodeClick, onNodeHover).

### Phase 3: Integration
- [ ] Create page route `src/app/graph/page.tsx`.
- [ ] Connect real data source (Supabase/Prisma) via Server Action or API.
- [ ] Add "Graph View" link to main navigation.

### Phase 4: Polish
- [ ] Add loading spinner while fetching graph data.
- [ ] Tune physics simulation (damping, charge) for stability.
- [ ] Ensure mobile touch support works for panning/zooming.

---

## üìÇ Files to Create/Modify

| File | Action | Purpose |
|------|--------|---------|
| `src/features/graph/index.ts` | CREATE | Public API for the feature |
| `src/features/graph/components/GraphCanvas.tsx` | CREATE | Main visualization component |
| `src/features/graph/hooks/useGraphData.ts` | CREATE | Data transformation logic |
| `src/features/graph/types.ts` | CREATE | Type definitions |
| `src/app/graph/page.tsx` | CREATE | Next.js Page route |
| `src/components/layout/Sidebar.tsx` | MODIFY | Add navigation link |

---

## üîó Dependencies

**Depends On** (must exist before starting):
- `src/lib/db.ts` or equivalent ‚Äî To fetch notes.
- `src/types/note.ts` ‚Äî Note entity definition.

**Used By** (will consume this):
- Main navigation
- Note details page (mini-graph context?)

**Related Files** (reference these):
- `docs/features/pomodoro_redesign.md` (Check for UI consistency)

---

## ‚úÖ Success Criteria

### Code Quality
- [ ] Strict typing for Node/Link data.
- [ ] No hydration errors from ForceGraph (ensure client-only render).
- [ ] Component is responsive.

### Functionality
- [ ] Graph renders with correct topology.
- [ ] Navigation works seamlessly.
- [ ] Smooth performance (60fps) on drag.

### Verification
- [ ] `npm run build` passes.
- [ ] Manual test: Create 3 linked notes, verify graph structure.

---

## üöÄ Getting Started

1. Read `src/types/note.ts` to understand data structure.
2. Install `react-force-graph-2d`.
3. Scaffold `src/features/graph/components/GraphCanvas.tsx`.
4. Use placeholder data to test rendering first.
5. Connect to real data.

---

*Generated by VibeCode Task Spawner*
